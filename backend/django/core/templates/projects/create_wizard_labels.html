{% extends "base.html" %}

{% load i18n %}
{% load static %}
{% load render_bundle from webpack_loader %}

{% block head %}
{{ wizard.form.media }}
{{ form.media.css }}
{% endblock %}

{% block content %}
<div class="error-messages">{{ wizard.non_form_errors }}</div>
<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <div class="card">
      <div class="cardface">
        <form action="." method="post" enctype="multipart/form-data">
          {% csrf_token %}
          {{ wizard.management_form }}

            <h1>Labels</h1>
            <p>You must provide the name of your labels here.  SMART <strong>requires at least two labels</strong> and the labels must be <strong>unique</strong>.</p>
            <p>If you have more than two labels use the <code>add label</code> button to add more rows to the form.  If you decide that you want to remove a label after adding it there will be a <code>remove label</code> button next to the name input.</p>
            <p>If your data file has labels in it then you must provide the exact labels here.</p>
            <p>You can not update the labels for a project after the project is created.</p>
            <table class="table table-striped">
              {{ wizard.form.management_form }}
              <div class="error-messages">{{ wizard.form.non_form_errors }}</div>
              {% for form in wizard.form %}
                {% if forloop.first %}
                  <thead>
                  <tr>
                    {% for field in form.visible_fields %}{% if field != data %}
                      <th>{{ field.label|capfirst }}</th>
                    {% endif %}{% endfor %}
                  </tr>
                  </thead>
                  {% endif %}
                  <tr class="formset_row_label">
                    {% for field in form.visible_fields %}
                      <td>
                        {# Include the hidden fields in the form #}
                        {% if forloop.first %}
                          {% for hidden in form.hidden_fields %}
                            {{ hidden }}
                          {% endfor %}
                        {% endif %}
                        <div class="error-messages">{{ field.errors.as_ul }}</div>
                        {{ field }}
                      </td>
                    {% endfor %}
                  </tr>
              {% endfor %}
            </table>
          <div>
            <button class="btn btn-info" name="wizard_goto_step" type="submit" value="project">1. Info</button>
            <input class="btn btn-primary" type="submit" value="Next Step"/>
            <p class="pull-right">Step {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</p>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts_body %}
<script type="text/javascript">
    $('.formset_row_label').formset({
        addText: 'add label',
        deleteText: 'remove label',
        prefix: 'label_set',
        added: function () {
            // Reset drop down and errors from both columns when adding new rows
            $('tr.formset_row_label').last().children(':first').find('ul.errorlist li').empty();
        }
    });
</script>
{% endblock %}